#Default compose args
pwd
ls -la
COMPOSE_ARGS=" -f identijenk/jenkins.yml -p jenkins "

#Make sure old containers are gone
sudo docker-compose $COMPOSE_ARGS stop
sudo docker-compose $COMPOSE_ARGS rm --force -v

#build the system
#sudo docker-compose $COMPOSE_ARGS build --no-cache
sudo docker-compose $COMPOSE_ARGS build
sudo docker-compose $COMPOSE_ARGS up -d

#sudo docker exec -d jenkins_identitest_1 Xvfb :99 -screen 0 1600x1200x24+32 &
sudo docker exec -d jenkins_identitest_1 Xvfb :99 -screen 0 4000x4000x24+32 &

#sudo docker exec -d jenkins_identitest_1 Xvfb :99 -screen 0 1024x768x8 &
sleep 5
sudo docker exec jenkins_identitest_1 /src/node_modules/protractor/bin/webdriver-manager start &
sleep 15
sudo docker exec jenkins_identitest_1 /src/node_modules/protractor/bin/protractor /src/conf.js
sleep 15

sudo docker exec jenkins_identitest_1 ls -la

sudo docker cp jenkins_identitest_1:/testresults/xmloutput.xml /var/jenkins_home/workspace/samplejob/xmloutput.xml
sudo docker cp jenkins_identitest_1:/sample.png /var/jenkins_home/workspace/samplejob/sample.png

#Pull down the system
sudo docker-compose $COMPOSE_ARGS stop
sudo docker-compose $COMPOSE_ARGS rm --force -v
